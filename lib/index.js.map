{"version":3,"sources":["../src/index.js"],"names":["rad","degree","Math","PI","DeviceOrientationControl","mViewMatrix","_mtxTarget","_rotation","create","_hasSet","_alpha","_beta","_gamma","easing","_init","connect","enabled","deviceOrientation","screenOrientation","alphaOffsetAngle","onScreenOrientationChangeBind","e","_onScreenOrientationChange","onDeviceOrientationChangeBind","_onDeviceOrientationChange","window","addEventListener","removeEventListener","alpha","beta","gamma","orient","setObjectQuaternion","q","zee","q0","q1","euler","x","y","z","c1","cos","c2","c3","s1","sin","s2","s3","w","set","sqrt","setAxisAngle","multiply","invert","fromQuat","orientation","event","update"],"mappings":"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","file":"index.js","sourcesContent":["// DeviceOrientationControl.js\n\nimport { mat4, quat, vec3 } from 'gl-matrix';\n\nconst rad = function (degree) {\n\treturn degree * Math.PI / 180;\n};\n\nclass DeviceOrientationControl {\n\tconstructor(mViewMatrix) {\n\t\tthis._mtxTarget = mViewMatrix;\n\t\tthis._rotation = mat4.create();\n\n\t\tthis._hasSet = false;\n\t\tthis._alpha = 0;\n\t\tthis._beta = 0;\n\t\tthis._gamma = 0;\n\t\tthis.easing = 0.1;\n\n\t\tthis._init();\n\t\tthis.connect();\n\t}\n\n\n\t_init() {\n\t\tthis.enabled = true;\n\n\t\tthis.deviceOrientation = {};\n\t\tthis.screenOrientation = 0;\n\n\t\tthis.alphaOffsetAngle = 0;\n\n\t\tthis.onScreenOrientationChangeBind = (e) => this._onScreenOrientationChange(e);\n\t\tthis.onDeviceOrientationChangeBind = (e) => this._onDeviceOrientationChange(e);\n\t}\n\n\n\tconnect() {\n\t\tthis.onScreenOrientationChangeBind();\n\n\t\twindow.addEventListener('orientationchange', this.onScreenOrientationChangeBind, false);\n\t\twindow.addEventListener('deviceorientation', this.onDeviceOrientationChangeBind, false);\n\n\t\tthis.enabled = true;\n\t}\n\n\n\tdisconnect() {\n\n\t\twindow.removeEventListener('orientationchange', this.onScreenOrientationChangeBind, false);\n\t\twindow.removeEventListener('deviceorientation', this.onDeviceOrientationChangeBind, false);\n\t\tthis.enabled = false;\n\t}\n\n\n\tupdate() {\n\t\tconst alpha = this.deviceOrientation.alpha ? rad(this.deviceOrientation.alpha) + this.alphaOffsetAngle : 0;\n\t\tconst beta = this.deviceOrientation.beta ? rad(this.deviceOrientation.beta) : 0;\n\t\tconst gamma = this.deviceOrientation.gamma ? rad(this.deviceOrientation.gamma) : 0;\n\t\tconst orient = this.screenOrientation ? rad(this.screenOrientation) : 0;\n\n\t\tif(!this._hasSet) {\n\t\t\tthis._alpha = alpha;\n\t\t\tthis._beta = beta;\n\t\t\tthis._gamma = gamma;\n\t\t} else {\n\t\t\tthis._alpha += (alpha - this._alpha) * this.easing;\n\t\t\tthis._beta += (beta - this._beta) * this.easing;\n\t\t\tthis._gamma += (gamma - this._gamma) * this.easing;\n\t\t}\n\n\t\tthis.setObjectQuaternion(this._alpha, this._beta, this._gamma, orient);\n\t}\n\n\tsetObjectQuaternion(alpha, beta, gamma, orient) {\n\t\tconst q = quat.create();\n\t\tconst zee  = vec3.create();\n\t\tconst q0 = quat.create();\n\t\tconst q1 = quat.create();\n\n\t\tzee[2] = 1;\n\n\t\t// YXZ\n\t\tconst euler = {\n\t\t\tx: beta,\n\t\t\ty: alpha,\n\t\t\tz: -gamma\n\t\t};\n\n\t\tconst c1 = Math.cos(euler.x / 2);\n\t\tconst c2 = Math.cos(euler.y / 2);\n\t\tconst c3 = Math.cos(euler.z / 2);\n\t\tconst s1 = Math.sin(euler.x / 2);\n\t\tconst s2 = Math.sin(euler.y / 2);\n\t\tconst s3 = Math.sin(euler.z / 2);\n\n\t\tconst x = s1 * c2 * c3 + c1 * s2 * s3;\n\t\tconst y = c1 * s2 * c3 - s1 * c2 * s3;\n\t\tconst z = c1 * c2 * s3 - s1 * s2 * c3;\n\t\tconst w = c1 * c2 * c3 + s1 * s2 * s3;\n\n\t\tquat.set(q, x, y, z, w);\n\t\tquat.set(q1, Math.sqrt(0.5), 0, 0, -Math.sqrt(0.5));\n\n\t\tquat.setAxisAngle(q0, zee, -orient);\n\n\t\tquat.multiply(q, q, q1);\n\t\tquat.multiply(q, q, q0);\n\n\t\tquat.invert(q, q);\n\t\tmat4.fromQuat(this._mtxTarget, q);\n\t\tmat4.fromQuat(this._rotation, q);\n\t}\n\n\t//\tEvent handlers\n\n\t_onScreenOrientationChange(e) {\n\t\tthis.screenOrientation = window.orientation || 0;\n\t}\n\n\t_onDeviceOrientationChange(e) {\n\t\tthis.deviceOrientation = event;\n\n\t\tthis.update();\n\t}\n\n\n\tget rotation() {\treturn this._rotation;\t}\n\n}\n\n\nexport default DeviceOrientationControl;\n"]}